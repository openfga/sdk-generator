{{>licenseInfo}}
package {{authPackage}};

import static {{utilPackage}}.StringUtil.isNullOrWhitespace;

import java.time.Instant;
import java.util.Random;

class AuthToken {
    private static final int TOKEN_EXPIRY_BUFFER_THRESHOLD_IN_SEC = {{tokenExpiryThresholdBufferInSec}};
    private static final int TOKEN_EXPIRY_JITTER_IN_SEC = {{tokenExpiryJitterInSec}}; // We add some jitter so that token refreshes are less likely to collide

    private final Random random = new Random();
    private Instant expiresAt;

    private String accessToken;

    public boolean isValid() {
        return !isNullOrWhitespace(accessToken)
                && (expiresAt == null
                        || expiresAt.isBefore(Instant.now()
                                .plusSeconds(TOKEN_EXPIRY_BUFFER_THRESHOLD_IN_SEC)
                                .plusSeconds(random.nextLong() % TOKEN_EXPIRY_JITTER_IN_SEC)));
    }

    public String getAccessToken() {
        return accessToken;
    }

    public void setExpiresAt(Instant expiresAt) {
        this.expiresAt = expiresAt;
    }

    public void setAccessToken(String accessToken) {
        this.accessToken = accessToken;
    }
}
