# coding: utf-8

{{>partial_header}}

import unittest
from unittest.mock import ANY
from mock import patch, Mock

import {{packageName}}
import urllib3
from pprint import pprint

from {{packageName}}.api import open_fga_api
from {{packageName}}.credentials import Credentials, CredentialConfiguration
from {{packageName}}.{{apiPackage}}.{{classFilename}} import {{classname}}  # noqa: E501
from {{packageName}}.exceptions import ApiTypeError, ApiValueError
from {{packageName}}.model.assertion import Assertion
from {{packageName}}.model.authorization_model import AuthorizationModel
from {{packageName}}.model.check_response import CheckResponse
from {{packageName}}.model.create_store_request import CreateStoreRequest
from {{packageName}}.model.create_store_response import CreateStoreResponse
from {{packageName}}.model.error_code import ErrorCode
from {{packageName}}.model.expand_response import ExpandResponse
from {{packageName}}.model.get_store_response import GetStoreResponse
from {{packageName}}.model.internal_error_code import InternalErrorCode
from {{packageName}}.model.internal_error_message_response import InternalErrorMessageResponse
from {{packageName}}.model.leaf import Leaf
from {{packageName}}.model.list_stores_response import ListStoresResponse
from {{packageName}}.model.model_tuple import ModelTuple
from {{packageName}}.model.node import Node
from {{packageName}}.model.not_found_error_code import NotFoundErrorCode
from {{packageName}}.model.object_relation import ObjectRelation
from {{packageName}}.model.path_unknown_error_message_response import PathUnknownErrorMessageResponse
from {{packageName}}.model.read_assertions_response import ReadAssertionsResponse
from {{packageName}}.model.read_authorization_model_response import ReadAuthorizationModelResponse
from {{packageName}}.model.read_authorization_models_response import ReadAuthorizationModelsResponse
from {{packageName}}.model.read_changes_response import ReadChangesResponse
from {{packageName}}.model.read_response import ReadResponse
from {{packageName}}.model.store import Store
from {{packageName}}.model.tuple_change import TupleChange
from {{packageName}}.model.tuple_key import TupleKey
from {{packageName}}.model.tuple_keys import TupleKeys
from {{packageName}}.model.type_definition import TypeDefinition
from {{packageName}}.model.type_definitions import TypeDefinitions
from {{packageName}}.model.users import Users
from {{packageName}}.model.userset import Userset
from {{packageName}}.model.userset_tree import UsersetTree
from {{packageName}}.model.usersets import Usersets
from {{packageName}}.model.validation_error_message_response import ValidationErrorMessageResponse
from {{packageName}}.model.write_authorization_model_response import WriteAuthorizationModelResponse

store_id='d12345abc'

# Helper function to construct mock response
def mock_response(body, status):
    headers = urllib3.response.HTTPHeaderDict({
        'content-type': 'application/json'
    })
    return urllib3.HTTPResponse(
        body,
        headers,
        status,
        preload_content=False
    )


class {{#with operations}}Test{{classname}}(unittest.TestCase):
    """{{classname}} unit test"""

    def setUp(self):
        self.configuration = {{packageName}}.Configuration(
            api_scheme = 'http',
            api_host = "api.fga.example",
        )

    def tearDown(self):
        pass

{{! We will need to define each test individually instead of via the generator to allow better control of what we are testing}}

    @patch.object({{packageName}}.api_client.ApiClient, 'request')
    def test_check(self, mock_request):
        """Test case for check

        Check whether a user is authorized to access an object  # noqa: E501
        """

        # First, mock the response
        response_body = '{"allowed": true}'
        mock_request.return_value = mock_response(response_body, 200)

        configuration = self.configuration
        configuration.store_id = store_id
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            body = dict(
                tuple_key=TupleKey(
                    object="document:2021-budget",
                    relation="reader",
                    user="anne",
                ),
            )
            api_response = api_instance.check(
                path_params=path_params,
                body=body,
            )
            self.assertIsInstance(api_response.body, CheckResponse)
            self.assertTrue(api_response.body.allowed)
            # Make sure the API was called with the right data
            mock_request.assert_called_once_with(
                'POST',
                'http://api.fga.example/stores/d12345abc/check',
                headers=ANY,
                fields=ANY,
                body=b'{"tuple_key":{"object":"document:2021-budget","relation":"reader","user":"anne"}}',
                stream=False,
                timeout=None
            )

    @patch.object({{packageName}}.api_client.ApiClient, 'request')
    def test_create_store(self, mock_request):
        """Test case for create_store

        Create a store  # noqa: E501
        """
        response_body = '''{
            "id": "01YCP46JKYM8FJCQ37NMBYHE5X",
            "name": "test_store",
            "created_at": "2022-07-25T17:41:26.607Z",
            "updated_at": "2022-07-25T17:41:26.607Z"}
            '''
        mock_request.return_value = mock_response(response_body, 201)

        configuration = self.configuration
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            body = CreateStoreRequest(
                name="test-store",
            )
            api_response = api_instance.create_store(
                body=body,
            )
            self.assertIsInstance(api_response.body, CreateStoreResponse)
            self.assertEqual(api_response.body.id, '01YCP46JKYM8FJCQ37NMBYHE5X')
            mock_request.assert_called_once_with(
                'POST',
                'http://api.fga.example/stores',
                headers=ANY,
                fields=ANY,
                body=b'{"name":"test-store"}',
                stream=False,
                timeout=None
            )

    @patch.object({{packageName}}.api_client.ApiClient, 'request')
    def test_delete_store(self, mock_request):
        """Test case for delete_store

        Delete a store  # noqa: E501
        """
        response_body = ''
        mock_request.return_value = mock_response(response_body, 201)
        configuration = self.configuration
        configuration.store_id = store_id
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            api_response = api_instance.delete_store(
                path_params=path_params,
            )
            mock_request.assert_called_once_with(
                'DELETE',
                'http://api.fga.example/stores/d12345abc',
                headers=ANY,
                fields=ANY,
                body=ANY,
                stream=False,
                timeout=None
            )

    @patch.object({{packageName}}.api_client.ApiClient, 'request')
    def test_expand(self, mock_request):
        """Test case for expand

        Expand all relationships in userset tree format, and following userset rewrite rules.  Useful to reason about and debug a certain relationship  # noqa: E501
        """
        response_body = '''{
            "tree": {"root": {"name": "document:budget#reader", "leaf": {"users": {"users": ["anne"]}}}}}
            '''
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            body = dict(
                tuple_key=TupleKey(
                    object="document:budget",
                    relation="reader",
                ),
            )
            api_response = api_instance.expand(
                path_params=path_params,
                body=body,
            )
            self.assertIsInstance(api_response.body, ExpandResponse)
            curUsers = Users({"users": ["anne"]})
            leaf = Leaf({"users": curUsers})
            node = Node({"name": "document:budget#reader", "leaf": leaf})
            expected_response = ExpandResponse({"tree": UsersetTree({"root": UsersetTree(node)})})
            self.assertEqual(api_response.body, expected_response)
            mock_request.assert_called_once_with(
                'POST',
                'http://api.fga.example/stores/d12345abc/expand',
                headers=ANY,
                fields=ANY,
                body=b'{"tuple_key":{"object":"document:budget","relation":"reader"}}',
                stream=False,
                timeout=None
            )

    @patch.object({{packageName}}.api_client.ApiClient, 'request')
    def test_get_store(self, mock_request):
        """Test case for get_store

        Get a store  # noqa: E501
        """
        response_body = '''{
  "id": "d12345abc",
  "name": "test_store",
  "created_at": "2022-07-25T20:45:10.485Z",
  "updated_at": "2022-07-25T20:45:10.485Z"
}
            '''
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            # Get a store
            api_response = api_instance.get_store(
                path_params=path_params,
            )
            self.assertIsInstance(api_response.body, GetStoreResponse)
            self.assertEqual(api_response.body.id, 'd12345abc')
            self.assertEqual(api_response.body.name, 'test_store')
            mock_request.assert_called_once_with(
                'GET',
                'http://api.fga.example/stores/d12345abc',
                headers=ANY,
                fields=ANY,
                body=None,
                stream=False,
                timeout=None
            )

    @patch.object({{packageName}}.api_client.ApiClient, 'request')
    def test_list_stores(self, mock_request):
        """Test case for list_stores

        Get all stores  # noqa: E501
        """
        response_body = '''
{
  "stores": [
    {
      "id": "01YCP46JKYM8FJCQ37NMBYHE5X",
      "name": "store1",
      "created_at": "2022-07-25T21:15:37.524Z",
      "updated_at": "2022-07-25T21:15:37.524Z",
      "deleted_at": "2022-07-25T21:15:37.524Z"
    },
    {
      "id": "01YCP46JKYM8FJCQ37NMBYHE6X",
      "name": "store2",
      "created_at": "2022-07-25T21:15:37.524Z",
      "updated_at": "2022-07-25T21:15:37.524Z",
      "deleted_at": "2022-07-25T21:15:37.524Z"
    }
  ],
  "continuation_token": "eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ=="
}
            '''
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            query_params = {
                'page_size': 1,
                'continuation_token': "continuation_token_example",
            }
            # Get all stores
            api_response = api_instance.list_stores(
                query_params=query_params,
            )
            self.assertIsInstance(api_response.body, ListStoresResponse)
            self.assertEqual(api_response.body.continuation_token,
                "eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ==")
            store1 = Store({
                "id" : "01YCP46JKYM8FJCQ37NMBYHE5X",
                "name" : "store1",
                "created_at" : "2022-07-25T21:15:37.524Z",
                "updated_at" : "2022-07-25T21:15:37.524Z",
                "deleted_at" : "2022-07-25T21:15:37.524Z",
            })
            store2 = Store({
                "id" : "01YCP46JKYM8FJCQ37NMBYHE6X",
                "name" : "store2",
                "created_at" : "2022-07-25T21:15:37.524Z",
                "updated_at" : "2022-07-25T21:15:37.524Z",
                "deleted_at" : "2022-07-25T21:15:37.524Z",
            })

            stores = (store1, store2)
            self.assertEqual(api_response.body.stores, stores)
            mock_request.assert_called_once_with(
                'GET',
                'http://api.fga.example/stores?page_size=1&continuation_token=continuation_token_example',
                headers=ANY,
                fields=ANY,
                body=None,
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_read(self, mock_request):
        """Test case for read

        Get tuples from the store that matches a query, without following userset rewrite rules  # noqa: E501
        """
        response_body = '''
            {
  "tuples": [
    {
      "key": {
        "user": "anne",
        "relation": "reader",
        "object": "document:2021-budget"
      },
      "timestamp": "2021-10-06T15:32:11.128Z"
    }
  ]
}
        '''
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        with openfga_sdk.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            body = dict(
                tuple_key=TupleKey(
                    object="document:2021-budget",
                    relation="reader",
                    user="anne",
                ),
                authorization_model_id="01G5JAVJ41T49E9TT3SKVS7X1J",
                page_size=50,
                continuation_token="eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ==",
            )
            api_response = api_instance.read(
                path_params=path_params,
                body=body,
            )
            self.assertIsInstance(api_response.body, ReadResponse)
            key = TupleKey({"user":"anne","relation":"reader","object":"document:2021-budget"})
            timestamp = "2021-10-06T15:32:11.128Z"
            expected_data = (TupleKey({"key": key, "timestamp": timestamp }),)
            self.assertEqual(api_response.body.tuples, expected_data)
            mock_request.assert_called_once_with(
                'POST',
                'http://api.fga.example/stores/d12345abc/read',
                headers=ANY,
                fields=ANY,
                body=b'{"tuple_key":{"object":"document:2021-budget","relation":"reader","user":"anne"},"authorization_model_id":"01G5JAVJ41T49E9TT3SKVS7X1J","page_size":50,"continuation_token":"eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ=="}',
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_read_assertions(self, mock_request):
        """Test case for read_assertions

        Read assertions for an authorization model ID  # noqa: E501
        """
        response_body = '''
{
  "authorization_model_id": "01G5JAVJ41T49E9TT3SKVS7X1J",
  "assertions": [
    {
      "tuple_key": {
        "object": "document:2021-budget",
        "relation": "reader",
        "user": "anne"
      },
      "expectation": true
    }
  ]
}
        '''
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        with openfga_sdk.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {
                'authorization_model_id': "01G5JAVJ41T49E9TT3SKVS7X1J",
            }
            api_response = api_instance.read_assertions(
                path_params=path_params,
            )
            self.assertIsInstance(api_response.body, ReadAssertionsResponse)
            self.assertEqual(api_response.body.authorization_model_id, '01G5JAVJ41T49E9TT3SKVS7X1J')
            assertion= Assertion(
                tuple_key=TupleKey(
                    object="document:2021-budget",
                    relation="reader",
                    user="anne",
                ),
                expectation=True,
            )
            self.assertEqual(api_response.body.assertions, (assertion,))
            mock_request.assert_called_once_with(
                'GET',
                'http://api.fga.example/stores/d12345abc/assertions/01G5JAVJ41T49E9TT3SKVS7X1J',
                headers=ANY,
                fields=ANY,
                body=None,
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_read_authorization_model(self, mock_request):
        """Test case for read_authorization_model

        Return a particular version of an authorization model  # noqa: E501
        """
        response_body = '''
{
  "authorization_model": {
    "id": "01G5JAVJ41T49E9TT3SKVS7X1J",
    "type_definitions": [
      {
        "type": "document",
        "relations": {
          "reader": {
            "union": {
              "child": [
                {
                  "this": {}
                },
                {
                  "computedUserset": {
                    "object": "",
                    "relation": "writer"
                  }
                }
              ]
            }
          },
          "writer": {
            "this": {}
          }
        }
      }
    ]
  }
}
        '''
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        # Enter a context with an instance of the API client
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
                'id': "01G5JAVJ41T49E9TT3SKVS7X1J",
            }
            # Return a particular version of an authorization model
            api_response = api_instance.read_authorization_model(
                path_params=path_params,
            )
            self.assertIsInstance(api_response.body, ReadAuthorizationModelResponse)
            type_definitions = ( 
                TypeDefinition(
                    type="document",
                    relations=dict(
                        reader=Userset(
                            union=Usersets(
                                child=[
                                    Userset(this=dict()),
                                    Userset(computedUserset=ObjectRelation(
                                        object="",
                                        relation="writer",
                                    )),
                                ],
                            ),
                        ),
					    writer=Userset(
                            this=dict(),
                        ),
		            )
                ),
            )
            authorization_model = AuthorizationModel(id='01G5JAVJ41T49E9TT3SKVS7X1J',
                type_definitions=type_definitions)
            self.assertEqual(api_response.body.authorization_model, authorization_model)
            mock_request.assert_called_once_with(
                'GET',
                'http://api.fga.example/stores/d12345abc/authorization-models/01G5JAVJ41T49E9TT3SKVS7X1J',
                headers=ANY,
                fields=ANY,
                body=None,
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_read_authorization_models(self, mock_request):
        """Test case for read_authorization_models

        Return all the authorization models for a particular store  # noqa: E501
        """
        response_body = '''
{
  "authorization_models": [ 
  {
    "id": "01G5JAVJ41T49E9TT3SKVS7X1J",
    "type_definitions": [
      {
        "type": "document",
        "relations": {
          "reader": {
            "union": {
              "child": [
                {
                  "this": {}
                },
                {
                  "computedUserset": {
                    "object": "",
                    "relation": "writer"
                  }
                }
              ]
            }
          },
          "writer": {
            "this": {}
          }
        }
      }
    ]
  }],
  "continuation_token": "eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ=="
}
        '''
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        # Enter a context with an instance of the API client
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
            }
            query_params = {
                "page_size": 1,
                "continuation_token": "abcdefg"
            }
            # Return a particular version of an authorization model
            api_response = api_instance.read_authorization_models(
                path_params=path_params,
                query_params=query_params,
            )
            self.assertIsInstance(api_response.body, ReadAuthorizationModelsResponse)
            type_definitions = ( 
                TypeDefinition(
                    type="document",
                    relations=dict(
                        reader=Userset(
                            union=Usersets(
                                child=[
                                    Userset(this=dict()),
                                    Userset(computedUserset=ObjectRelation(
                                        object="",
                                        relation="writer",
                                    )),
                                ],
                            ),
                        ),
					    writer=Userset(
                            this=dict(),
                        ),
		            )
                ),
            )
            authorization_model = AuthorizationModel(id='01G5JAVJ41T49E9TT3SKVS7X1J',
                type_definitions=type_definitions)
            self.assertEqual(api_response.body.authorization_models, (authorization_model,))
            self.assertEqual(api_response.body.continuation_token,
                "eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ==")
            mock_request.assert_called_once_with(
                'GET',
                'http://api.fga.example/stores/d12345abc/authorization-models?page_size=1&continuation_token=abcdefg',
                headers=ANY,
                fields=ANY,
                body=None,
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_read_changes(self, mock_request):
        """Test case for read_changes

        Return a list of all the tuple changes  # noqa: E501
        """
        response_body = '''
{
  "changes": [
    {
      "tuple_key": {
        "object": "document:2021-budget",
        "relation": "reader",
        "user": "anne"
      },
      "operation": "TUPLE_OPERATION_WRITE",
      "timestamp": "2022-07-26T15:55:55.809Z"
    }
  ],
  "continuation_token": "eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ=="
}
        '''
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        # Enter a context with an instance of the API client
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
            }
            query_params = {
                "page_size": 1,
                "continuation_token": "abcdefg",
                "type": "document"
            }
            # Return a particular version of an authorization model
            api_response = api_instance.read_changes(
                path_params=path_params,
                query_params=query_params,
            )
            self.assertIsInstance(api_response.body, ReadChangesResponse)
            changes = TupleChange(
                tuple_key=TupleKey(object="document:2021-budget",relation="reader",user="anne"),
                operation="TUPLE_OPERATION_WRITE",
                timestamp="2022-07-26T15:55:55.809Z")
            read_changes = ReadChangesResponse(
                continuation_token='eyJwayI6IkxBVEVTVF9OU0NPTkZJR19hdXRoMHN0b3JlIiwic2siOiIxem1qbXF3MWZLZExTcUoyN01MdTdqTjh0cWgifQ==',
                changes=(changes,))
            self.assertEqual(api_response.body, read_changes)
            mock_request.assert_called_once_with(
                'GET',
                'http://api.fga.example/stores/d12345abc/changes?type=document&page_size=1&continuation_token=abcdefg',
                headers=ANY,
                fields=ANY,
                body=None,
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_write(self, mock_request):
        """Test case for write

        Add tuples from the store  # noqa: E501
        """
        response_body = '{}'
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        # Enter a context with an instance of the API client
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
            }
            body = dict(
                writes=TupleKeys(
                    tuple_keys=[
                        TupleKey(
                            object="document:2021-budget",
                            relation="reader",
                            user="anne",
                        )
                    ],
                ),
                authorization_model_id="01G5JAVJ41T49E9TT3SKVS7X1J",
            )
            api_response = api_instance.write(
                path_params=path_params,
                body=body,
            )
            mock_request.assert_called_once_with(
                'POST',
                'http://api.fga.example/stores/d12345abc/write',
                headers=ANY,
                fields=ANY,
                body=b'{"writes":{"tuple_keys":[{"object":"document:2021-budget","relation":"reader","user":"anne"}]},"authorization_model_id":"01G5JAVJ41T49E9TT3SKVS7X1J"}',
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_write_delete(self, mock_request):
        """Test case for write

        Delete tuples from the store  # noqa: E501
        """
        response_body = '{}'
        mock_request.return_value = mock_response(response_body, 200)
        configuration = self.configuration
        configuration.store_id = store_id
        # Enter a context with an instance of the API client
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
            }
            body = dict(
                deletes=TupleKeys(
                    tuple_keys=[
                        TupleKey(
                            object="document:2021-budget",
                            relation="reader",
                            user="anne",
                        )
                    ],
                ),
                authorization_model_id="01G5JAVJ41T49E9TT3SKVS7X1J",
            )
            api_response = api_instance.write(
                path_params=path_params,
                body=body,
            )
            mock_request.assert_called_once_with(
                'POST',
                'http://api.fga.example/stores/d12345abc/write',
                headers=ANY,
                fields=ANY,
                body=b'{"deletes":{"tuple_keys":[{"object":"document:2021-budget","relation":"reader","user":"anne"}]},"authorization_model_id":"01G5JAVJ41T49E9TT3SKVS7X1J"}',
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_write_assertions(self, mock_request):
        """Test case for write_assertions

        Upsert assertions for an authorization model ID  # noqa: E501
        """
        response_body = ''
        mock_request.return_value = mock_response(response_body, 204)
        configuration = self.configuration
        configuration.store_id = store_id
        # Enter a context with an instance of the API client
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
                'authorization_model_id': "xyz0123",
            }
            body = dict(
                assertions=[
                    Assertion(
                        tuple_key=TupleKey(
                            object="document:2021-budget",
                            relation="reader",
                            user="anne",
                        ),
                        expectation=True,
                    )
                ],
            )
            # Upsert assertions for an authorization model ID
            api_response = api_instance.write_assertions(
                path_params=path_params,
                body=body,
            )
            mock_request.assert_called_once_with(
                'PUT',
                'http://api.fga.example/stores/d12345abc/assertions/xyz0123',
                headers=ANY,
                fields=ANY,
                body=b'{"assertions":[{"expectation":true,"tuple_key":{"object":"document:2021-budget","relation":"reader","user":"anne"}}]}',
                stream=False,
                timeout=None
            )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_write_authorization_model(self, mock_request):
        """Test case for write_authorization_model

        Create a new authorization model  # noqa: E501
        """
        response_body = '{"authorization_model_id": "01G5JAVJ41T49E9TT3SKVS7X1J"}'
        mock_request.return_value = mock_response(response_body, 201)
        configuration = self.configuration
        configuration.store_id = store_id
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
            }
            body = TypeDefinitions(
                type_definitions=[
                    TypeDefinition(
                        type="document",
                        relations=dict(
			        		writer=Userset(
                                this=dict(),
                            ),
                            reader=Userset(
                                union=Usersets(
                                    child=[
                                        Userset(this=dict()),
                                        Userset(computedUserset=ObjectRelation(
                                            object="",
                                            relation="writer",
                                        )),
                                    ],
                                ),
                            ),
		                )
                    ),
                ],
            )
            # Create a new authorization model
            api_response = api_instance.write_authorization_model(
                path_params=path_params,
                body=body,
            )
            self.assertIsInstance(api_response.body, WriteAuthorizationModelResponse)
            expected_response = WriteAuthorizationModelResponse(
                authorization_model_id='01G5JAVJ41T49E9TT3SKVS7X1J'
            )
            self.assertEqual(api_response.body, expected_response)
            mock_request.assert_called_once_with(
                'POST',
                'http://api.fga.example/stores/d12345abc/authorization-models',
                headers=ANY,
                fields=ANY,
                body=b'{"type_definitions":[{"type":"document","relations":{"writer":{"this":{}},"reader":{"union":{"child":[{"this":{}},{"computedUserset":{"object":"","relation":"writer"}}]}}}}]}',
                stream=False,
                timeout=None
            )

    def test_default_scheme(self):
        """
        Ensure default scheme is https
        """
        configuration = {{packageName}}.Configuration(
            api_host='localhost'
        )
        self.assertEqual(configuration.api_scheme, 'https')

    def test_host_port(self):
        """
        Ensure host has port will not raise error
        """
        configuration = {{packageName}}.Configuration(
            api_host='localhost:3000'
        )
        self.assertEqual(configuration.api_host, 'localhost:3000')

    def test_configuration_missing_host(self):
        """
        Test whether ApiTypeError is raised if configuration does not have host specified
        """
        configuration = {{packageName}}.Configuration(
            api_scheme='http'
        )
        self.assertRaises(ApiTypeError, configuration.is_valid)

    def test_configuration_missing_scheme(self):
        """
        Test whether ApiTypeError is raised if configuration does not have scheme specified
        """
        configuration = {{packageName}}.Configuration(
            api_host='localhost'
        )
        configuration.api_scheme = None
        self.assertRaises(ApiTypeError, configuration.is_valid)

    def test_configuration_bad_scheme(self):
        """
        Test whether ApiValueError is raised if scheme is bad
        """
        configuration = {{packageName}}.Configuration(
            api_host='localhost',
            api_scheme='foo'
        )
        self.assertRaises(ApiValueError, configuration.is_valid)

    def test_configuration_bad_host(self):
        """
        Test whether ApiValueError is raised if host is bad
        """
        configuration = {{packageName}}.Configuration(
            api_host='/',
            api_scheme='foo'
        )
        self.assertRaises(ApiValueError, configuration.is_valid)

    def test_configuration_has_path(self):
        """
        Test whether ApiValueError is raised if host has path
        """
        configuration = {{packageName}}.Configuration(
            api_host='localhost/mypath',
            api_scheme='http'
        )
        self.assertRaises(ApiValueError, configuration.is_valid)

    def test_configuration_has_query(self):
        """
        Test whether ApiValueError is raised if host has query
        """
        configuration = {{packageName}}.Configuration(
            api_host='localhost?mypath=foo',
            api_scheme='http'
        )
        self.assertRaises(ApiValueError, configuration.is_valid)

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_bad_configuration_read_authorization_model(self, mock_request):
        """
        Test whether ApiTypeError is raised for API (reading authorization models)
        with configuration is having incorrect API scheme
        """
        response_body = '{}'
        mock_request.return_value = mock_response(response_body, 200)
        configuration = {{packageName}}.Configuration(
            api_scheme = 'bad',
            api_host = "api.fga.example",
        )
        configuration.store_id = 'xyz123'
        # Enter a context with an instance of the API client
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
            }
            query_params = {
                "page_size": 1,
                "continuation_token": "abcdefg"
            }

            # expects ApiTypeError to be thrown because api_scheme is bad
            with self.assertRaises(ApiValueError):
                api_instance.read_authorization_models(
                    path_params=path_params,
                    query_params=query_params,
                )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_configuration_missing_storeid(self, mock_request):
        """
        Test whether ApiTypeError is raised for API (reading authorization models)
        required store ID but configuration is missing store ID
        """
        response_body = '{}'
        mock_request.return_value = mock_response(response_body, 200)
        configuration = {{packageName}}.Configuration(
            api_scheme = 'http',
            api_host = "api.fga.example",
        )
        # Notice the store_id is not set
        # Enter a context with an instance of the API client
        with openfga_sdk.ApiClient(configuration) as api_client:
            # Create an instance of the API class
            api_instance = open_fga_api.OpenFgaApi(api_client)

            # example passing only required values which don't have defaults set
            path_params = {
            }
            query_params = {
                "page_size": 1,
                "continuation_token": "abcdefg"
            }

            # expects ApiTypeError to be thrown because store_id is not specified
            with self.assertRaises(ApiTypeError):
                api_instance.read_authorization_models(
                    path_params=path_params,
                    query_params=query_params,
                )

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_400_error(self, mock_request):
        """
        Test to ensure 400 errors are handled properly
        """
        response_body = '''
{
  "code": "validation_error",
  "message": "Generic validation error"
}
        '''
        mock_request.return_value = mock_response(response_body, 400)

        configuration = self.configuration
        configuration.store_id = store_id
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            body = dict(
                tuple_key=TupleKey(
                    object="document:2021-budget",
                    relation="reader",
                    user="anne",
                ),
            )
            with self.assertRaises(openfga_sdk.ApiException) as api_exception:
                api_instance.check(
                    path_params=path_params,
                    body=body,
                )
            self.assertEqual(api_exception.exception.status, 400)
            self.assertIsInstance(api_exception.exception.parsed_body, ValidationErrorMessageResponse)
            self.assertEqual(api_exception.exception.parsed_body.code, ErrorCode("validation_error"))
            self.assertEqual(api_exception.exception.parsed_body.message, "Generic validation error")

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_404_error(self, mock_request):
        """
        Test to ensure 404 errors are handled properly
        """
        response_body = '''
{
  "code": "undefined_endpoint",
  "message": "Endpoint not enabled"
}
        '''
        mock_request.return_value = mock_response(response_body, 404)

        configuration = self.configuration
        configuration.store_id = store_id
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            body = dict(
                tuple_key=TupleKey(
                    object="document:2021-budget",
                    relation="reader",
                    user="anne",
                ),
            )
            with self.assertRaises(openfga_sdk.ApiException) as api_exception:
                api_instance.check(
                    path_params=path_params,
                    body=body,
                )
            self.assertEqual(api_exception.exception.status, 404)
            self.assertIsInstance(api_exception.exception.parsed_body, PathUnknownErrorMessageResponse)
            self.assertEqual(api_exception.exception.parsed_body.code, NotFoundErrorCode("undefined_endpoint"))
            self.assertEqual(api_exception.exception.parsed_body.message, "Endpoint not enabled")

    @patch.object(openfga_sdk.api_client.ApiClient, 'request')
    def test_500_error(self, mock_request):
        """
        Test to ensure 500 errors are handled properly
        """
        response_body = '''
{
  "code": "internal_error",
  "message": "Internal Server Error"
}
        '''
        mock_request.return_value = mock_response(response_body, 500)

        configuration = self.configuration
        configuration.store_id = store_id
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            body = dict(
                tuple_key=TupleKey(
                    object="document:2021-budget",
                    relation="reader",
                    user="anne",
                ),
            )
            with self.assertRaises(openfga_sdk.ApiException) as api_exception:
                api_instance.check(
                    path_params=path_params,
                    body=body,
                )
            self.assertEqual(api_exception.exception.status, 500)
            self.assertIsInstance(api_exception.exception.parsed_body, InternalErrorMessageResponse)
            self.assertEqual(api_exception.exception.parsed_body.code, InternalErrorCode("internal_error"))
            self.assertEqual(api_exception.exception.parsed_body.message, "Internal Server Error")

    @patch.object({{packageName}}.api_client.ApiClient, 'request')
    def test_check_api_token(self, mock_request):
        """Test case for API token

        Check whether API token is send when configuration specifies credential method as api_token
        """

        # First, mock the response
        response_body = '{"allowed": true}'
        mock_request.return_value = mock_response(response_body, 200)

        configuration = self.configuration
        configuration.store_id = store_id
        configuration.credentials = Credentials(method='api_token', configuration=CredentialConfiguration(api_token='TOKEN1'))
        with {{packageName}}.ApiClient(self.configuration) as api_client:
            api_instance = open_fga_api.OpenFgaApi(api_client)
            path_params = {}
            body = dict(
                tuple_key=TupleKey(
                    object="document:2021-budget",
                    relation="reader",
                    user="anne",
                ),
            )
            api_response = api_instance.check(
                path_params=path_params,
                body=body,
            )
            self.assertIsInstance(api_response.body, CheckResponse)
            self.assertTrue(api_response.body.allowed)
            # Make sure the API was called with the right data
            expectedHeader = urllib3.response.HTTPHeaderDict({'Accept': 'application/json', 'Content-Type': 'application/json', 'User-Agent': 'openfga-sdk (python) {{packageVersion}}', 'Authorization': 'Bearer TOKEN1'})
            mock_request.assert_called_once_with(
                'POST',
                'http://api.fga.example/stores/d12345abc/check',
                headers=expectedHeader,
                fields=ANY,
                body=b'{"tuple_key":{"object":"document:2021-budget","relation":"reader","user":"anne"}}',
                stream=False,
                timeout=None
            )


{{/with}}

if __name__ == '__main__':
    unittest.main()
